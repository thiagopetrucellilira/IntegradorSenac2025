<div class="dashboard-container">
  <div class="container">
    <!-- Header -->
    <div class="page-header">
      <h1>
        <mat-icon>dashboard</mat-icon>
        Dashboard
        <button mat-icon-button (click)="refreshData()" class="refresh-button" title="Atualizar dados">
          <mat-icon>refresh</mat-icon>
        </button>
      </h1>
      <p>Bem-vindo(a), {{ currentUser?.name }}!</p>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <button mat-raised-button color="primary" routerLink="/create-donation" class="action-button">
        <mat-icon>add_circle</mat-icon>
        Nova Doação
      </button>
      <button mat-button routerLink="/donations" class="action-button">
        <mat-icon>search</mat-icon>
        Buscar Doações
      </button>
      <button mat-button routerLink="/profile" class="action-button">
        <mat-icon>person</mat-icon>
        Meu Perfil
      </button>
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
      <mat-icon class="loading-icon">hourglass_empty</mat-icon>
      <p>Carregando seus dados...</p>
    </div>

    <!-- Dashboard Content -->
    <div class="dashboard-content" *ngIf="!loading">
      
      <!-- Stats Cards -->
      <div class="stats-section">
        <h2 class="section-title">Resumo</h2>
        <div class="stats-grid">
          <mat-card class="stat-card">
            <mat-card-content>
              <div class="stat-header">
                <mat-icon>volunteer_activism</mat-icon>
                <span class="stat-number">{{ getDonationStats().total }}</span>
              </div>
              <h3>Minhas Doações</h3>
              <p>{{ getDonationStats().available }} disponíveis, {{ getDonationStats().completed }} concluídas</p>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-content>
              <div class="stat-header">
                <mat-icon>inbox</mat-icon>
                <span class="stat-number">{{ getRequestStats().total }}</span>
              </div>
              <h3>Solicitações Recebidas</h3>
              <p>{{ getRequestStats().pending }} pendentes, {{ getRequestStats().approved }} aprovadas</p>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-content>
              <div class="stat-header">
                <mat-icon>send</mat-icon>
                <span class="stat-number">{{ myRequests.length }}</span>
              </div>
              <h3>Minhas Solicitações</h3>
              <p>Doações que você solicitou</p>
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <!-- Tabs Content -->
      <mat-tab-group class="dashboard-tabs">
        
        <!-- My Donations Tab -->
        <mat-tab label="Minhas Doações">
          <div class="tab-content">
            <div class="donations-grid" *ngIf="myDonations.length > 0; else noDonations">
              <mat-card class="donation-card" *ngFor="let donation of myDonations">
                <mat-card-header>
                  <mat-card-title>{{ donation.title }}</mat-card-title>
                  <mat-card-subtitle>
                    <mat-chip [color]="getStatusColor(donation.status)" selected>
                      {{ getStatusText(donation.status) }}
                    </mat-chip>
                  </mat-card-subtitle>
                </mat-card-header>

                <mat-card-content>
                  <p class="donation-description">{{ donation.description }}</p>
                  
                  <div class="donation-details">
                    <div class="detail-item">
                      <mat-icon>category</mat-icon>
                      <span>{{ donation.category }}</span>
                    </div>
                    <div class="detail-item">
                      <mat-icon>inventory</mat-icon>
                      <span>Qtd: {{ donation.quantity }}</span>
                    </div>
                    <div class="detail-item" *ngIf="donation.city">
                      <mat-icon>location_on</mat-icon>
                      <span>{{ donation.city }}</span>
                    </div>
                    <div class="detail-item">
                      <mat-icon>schedule</mat-icon>
                      <span>{{ donation.createdAt | date:'dd/MM/yyyy' }}</span>
                    </div>
                  </div>
                </mat-card-content>

                <mat-card-actions>
                  <button mat-button [matMenuTriggerFor]="donationMenu">
                    <mat-icon>more_vert</mat-icon>
                    Ações
                  </button>
                  
                  <mat-menu #donationMenu="matMenu">
                    <button mat-menu-item (click)="navigateToEdit(donation)" 
                            [disabled]="!canUpdateDonation(donation)">
                      <mat-icon>edit</mat-icon>
                      <span>Editar</span>
                    </button>
                    <button mat-menu-item (click)="deleteDonation(donation)" 
                            [disabled]="donation.status === 'COMPLETED'">
                      <mat-icon>delete</mat-icon>
                      <span>Excluir</span>
                    </button>
                  </mat-menu>
                </mat-card-actions>
              </mat-card>
            </div>

            <ng-template #noDonations>
              <div class="empty-state">
                <mat-icon>volunteer_activism</mat-icon>
                <h3>Nenhuma doação criada</h3>
                <p>Que tal compartilhar algo que você não usa mais?</p>
                <button mat-raised-button color="primary" routerLink="/create-donation" class="action-button">
                  <mat-icon>add_circle</mat-icon>
                  Criar Primeira Doação
                </button>
              </div>
            </ng-template>
          </div>
        </mat-tab>

        <!-- Received Requests Tab -->
        <mat-tab label="Solicitações Recebidas">
          <div class="tab-content">
            <div class="requests-list" *ngIf="receivedRequests.length > 0; else noReceivedRequests">
              <mat-card class="request-card" *ngFor="let request of receivedRequests">
                <mat-card-header>
                  <mat-card-title>{{ request.donation?.title }}</mat-card-title>
                  <mat-card-subtitle>
                    <mat-chip [color]="getStatusColor(request.status)" selected>
                      {{ getStatusText(request.status) }}
                    </mat-chip>
                  </mat-card-subtitle>
                </mat-card-header>

                <mat-card-content>
                  <div class="request-info">
                    <div class="requester-info">
                      <mat-icon>person</mat-icon>
                      <span><strong>{{ request.requester?.name }}</strong></span>
                    </div>
                    
                    <div class="request-message" *ngIf="request.message">
                      <p><strong>Mensagem:</strong></p>
                      <p>{{ request.message }}</p>
                    </div>
                    
                    <div class="request-date">
                      <mat-icon>schedule</mat-icon>
                      <span>{{ request.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
                    </div>
                  </div>
                </mat-card-content>

                <mat-card-actions *ngIf="request.status === 'PENDING'">
                  <button mat-button color="primary" 
                          (click)="updateMatchStatus(request, MatchStatus.APPROVED)">
                    <mat-icon>check</mat-icon>
                    Aprovar
                  </button>
                  <button mat-button color="warn" 
                          (click)="updateMatchStatus(request, MatchStatus.REJECTED)">
                    <mat-icon>close</mat-icon>
                    Rejeitar
                  </button>
                </mat-card-actions>

                <mat-card-actions *ngIf="request.status === 'APPROVED'">
                  <button mat-button color="accent" 
                          (click)="updateMatchStatus(request, MatchStatus.COMPLETED)">
                    <mat-icon>done_all</mat-icon>
                    Marcar como Concluída
                  </button>
                </mat-card-actions>
              </mat-card>
            </div>

            <ng-template #noReceivedRequests>
              <div class="empty-state">
                <mat-icon>inbox</mat-icon>
                <h3>Nenhuma solicitação recebida</h3>
                <p>Quando alguém solicitar suas doações, aparecerão aqui.</p>
              </div>
            </ng-template>
          </div>
        </mat-tab>

        <!-- My Requests Tab -->
        <mat-tab label="Minhas Solicitações">
          <div class="tab-content">
            <div class="requests-list" *ngIf="myRequests.length > 0; else noMyRequests">
              <mat-card class="request-card" *ngFor="let request of myRequests">
                <mat-card-header>
                  <mat-card-title>{{ request.donation?.title }}</mat-card-title>
                  <mat-card-subtitle>
                    <mat-chip [color]="getStatusColor(request.status)" selected>
                      {{ getStatusText(request.status) }}
                    </mat-chip>
                  </mat-card-subtitle>
                </mat-card-header>

                <mat-card-content>
                  <div class="request-info">
                    <div class="donor-info">
                      <mat-icon>person</mat-icon>
                      <span><strong>Doador:</strong> {{ request.donation?.donor?.name }}</span>
                    </div>
                    
                    <div class="request-message" *ngIf="request.message">
                      <p><strong>Sua mensagem:</strong></p>
                      <p>{{ request.message }}</p>
                    </div>
                    
                    <div class="request-date">
                      <mat-icon>schedule</mat-icon>
                      <span>Solicitado em {{ request.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
                    </div>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>

            <ng-template #noMyRequests>
              <div class="empty-state">
                <mat-icon>send</mat-icon>
                <h3>Nenhuma solicitação enviada</h3>
                <p>Explore as doações disponíveis e faça sua primeira solicitação!</p>
                <button mat-button routerLink="/donations">
                  <mat-icon>search</mat-icon>
                  Ver Doações
                </button>
              </div>
            </ng-template>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
</div>
