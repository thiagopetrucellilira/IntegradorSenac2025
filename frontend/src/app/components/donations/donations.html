<div class="donations-container">
  <div class="container">
    <div class="page-header">
      <h1>
        <mat-icon>card_giftcard</mat-icon>
        Doações Disponíveis
      </h1>
      <p>Encontre itens doados pela comunidade local</p>
    </div>

    <!-- Filters Section -->
    <mat-card class="filters-card">
      <mat-card-content>
        <form [formGroup]="filterForm" class="filters-form">
          <div class="filter-row">
            <mat-form-field class="search-field">
              <mat-label>Buscar doações</mat-label>
              <input matInput formControlName="search" placeholder="Digite o que você procura...">
              <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>

            <mat-form-field>
              <mat-label>Categoria</mat-label>
              <mat-select formControlName="category">
                <mat-option value="">Todas as categorias</mat-option>
                <mat-option *ngFor="let category of categories" [value]="category">
                  {{ category }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field>
              <mat-label>Cidade</mat-label>
              <input matInput formControlName="city" placeholder="Ex: São Paulo">
            </mat-form-field>

            <mat-form-field>
              <mat-label>Estado</mat-label>
              <mat-select formControlName="state">
                <mat-option value="">Todos os estados</mat-option>
                <mat-option *ngFor="let state of states" [value]="state">
                  {{ state }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <button mat-button (click)="clearFilters()" type="button">
              <mat-icon>clear</mat-icon>
              Limpar
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
      <mat-icon class="loading-icon">hourglass_empty</mat-icon>
      <p>Carregando doações...</p>
    </div>

    <!-- Donations Grid -->
    <div class="donations-grid" *ngIf="!loading">
      <mat-card class="donation-card" *ngFor="let donation of donations">
        <div class="donation-image">
          <mat-icon class="placeholder-icon">card_giftcard</mat-icon>
        </div>

        <mat-card-content>
          <div class="donation-header">
            <h3 class="donation-title">{{ donation.title }}</h3>
            <mat-chip [color]="getStatusColor(donation.status)" selected>
              {{ getStatusText(donation.status) }}
            </mat-chip>
          </div>

          <p class="donation-description">{{ donation.description }}</p>

          <div class="donation-details">
            <div class="detail-item">
              <mat-icon>category</mat-icon>
              <span>{{ donation.category }}</span>
            </div>

            <div class="detail-item" *ngIf="donation.condition">
              <mat-icon>info</mat-icon>
              <span>{{ donation.condition }}</span>
            </div>

            <div class="detail-item">
              <mat-icon>inventory</mat-icon>
              <span>Quantidade: {{ donation.quantity }}</span>
            </div>

            <div class="detail-item" *ngIf="donation.city">
              <mat-icon>location_on</mat-icon>
              <span>{{ donation.city }}{{ donation.state ? ', ' + donation.state : '' }}</span>
            </div>

            <div class="detail-item" *ngIf="donation.donor">
              <mat-icon>person</mat-icon>
              <span>{{ donation.donor.name }}</span>
            </div>

            <div class="detail-item">
              <mat-icon>schedule</mat-icon>
              <span>{{ donation.createdAt | date:'dd/MM/yyyy' }}</span>
            </div>
          </div>

          <div class="donation-instructions" *ngIf="donation.pickupInstructions">
            <h4>Instruções para retirada:</h4>
            <p>{{ donation.pickupInstructions }}</p>
          </div>
        </mat-card-content>

        <mat-card-actions>
          <button mat-raised-button color="primary" 
                  (click)="requestDonation(donation)"
                  [disabled]="donation.status !== 'AVAILABLE'">
            <mat-icon>volunteer_activism</mat-icon>
            {{ isLoggedIn() ? 'Solicitar Doação' : 'Faça login para solicitar' }}
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!loading && donations.length === 0">
      <mat-icon class="empty-icon">search_off</mat-icon>
      <h3>Nenhuma doação encontrada</h3>
      <p>Tente ajustar os filtros ou volte mais tarde para ver novas doações.</p>
      <button mat-button (click)="clearFilters()">
        <mat-icon>refresh</mat-icon>
        Limpar filtros
      </button>
    </div>

    <!-- Pagination -->
    <mat-paginator 
      *ngIf="!loading && donations.length > 0"
      [length]="totalElements"
      [pageSize]="pageSize"
      [pageSizeOptions]="[5, 10, 20, 50]"
      (page)="onPageChange($event)"
      showFirstLastButtons>
    </mat-paginator>
  </div>
</div>
