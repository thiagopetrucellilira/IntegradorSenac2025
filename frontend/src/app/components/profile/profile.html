<div class="profile-container">
  <div class="container">
    <!-- Header -->
    <div class="page-header">
      <h1>
        <mat-icon>person</mat-icon>
        Meu Perfil
      </h1>
      <p>Gerencie suas informações pessoais e acompanhe suas atividades</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-icon class="loading-icon">hourglass_empty</mat-icon>
      <p>Carregando seus dados...</p>
    </div>

    <!-- Profile Content -->
    <div *ngIf="!isLoading && currentUser" class="profile-content">
      
      <!-- Profile Tabs -->
      <mat-tab-group class="profile-tabs" mat-stretch-tabs="false">
        
        <!-- Profile Information Tab -->
        <mat-tab label="Informações Pessoais">
          <div class="tab-content">
            <mat-card class="profile-form-card">
              <mat-card-header>
                <mat-icon mat-card-avatar>edit</mat-icon>
                <mat-card-title>Dados do Perfil</mat-card-title>
                <mat-card-subtitle>Atualize suas informações pessoais</mat-card-subtitle>
              </mat-card-header>
              
              <mat-card-content>
                <form [formGroup]="profileForm" (ngSubmit)="onUpdateProfile()">
                  <div class="form-row">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Nome completo</mat-label>
                      <input matInput formControlName="name" placeholder="Digite seu nome completo">
                      <mat-icon matSuffix>person</mat-icon>
                      <mat-error *ngIf="profileForm.get('name')?.hasError('required')">
                        Nome é obrigatório
                      </mat-error>
                      <mat-error *ngIf="profileForm.get('name')?.hasError('minlength')">
                        Nome deve ter pelo menos 2 caracteres
                      </mat-error>
                    </mat-form-field>
                  </div>

                  <div class="form-row">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>E-mail</mat-label>
                      <input matInput type="email" formControlName="email" placeholder="Digite seu e-mail">
                      <mat-icon matSuffix>email</mat-icon>
                      <mat-error *ngIf="profileForm.get('email')?.hasError('required')">
                        E-mail é obrigatório
                      </mat-error>
                      <mat-error *ngIf="profileForm.get('email')?.hasError('email')">
                        E-mail inválido
                      </mat-error>
                    </mat-form-field>
                  </div>

                  <div class="form-row">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Telefone</mat-label>
                      <input matInput formControlName="phone" placeholder="(00) 00000-0000" 
                             (input)="onPhoneInput($event)" maxlength="15">
                      <mat-icon matSuffix>phone</mat-icon>
                      <mat-error *ngIf="profileForm.get('phone')?.hasError('required')">
                        Telefone é obrigatório
                      </mat-error>
                      <mat-error *ngIf="profileForm.get('phone')?.hasError('pattern')">
                        Telefone inválido
                      </mat-error>
                    </mat-form-field>
                  </div>

                  <div class="form-row">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Endereço</mat-label>
                      <input matInput formControlName="address" placeholder="Digite seu endereço">
                      <mat-icon matSuffix>location_on</mat-icon>
                      <mat-error *ngIf="profileForm.get('address')?.hasError('required')">
                        Endereço é obrigatório
                      </mat-error>
                    </mat-form-field>
                  </div>

                  <div class="form-row two-columns">
                    <mat-form-field appearance="outline">
                      <mat-label>Cidade</mat-label>
                      <input matInput formControlName="city" placeholder="Digite sua cidade">
                      <mat-icon matSuffix>location_city</mat-icon>
                      <mat-error *ngIf="profileForm.get('city')?.hasError('required')">
                        Cidade é obrigatória
                      </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                      <mat-label>Estado</mat-label>
                      <input matInput formControlName="state" placeholder="Digite seu estado">
                      <mat-icon matSuffix>map</mat-icon>
                      <mat-error *ngIf="profileForm.get('state')?.hasError('required')">
                        Estado é obrigatório
                      </mat-error>
                    </mat-form-field>
                  </div>
                </form>
              </mat-card-content>

              <mat-card-actions>
                <button mat-raised-button color="primary" 
                        [disabled]="!profileForm.valid || isSaving"
                        (click)="onUpdateProfile()">
                  <mat-icon *ngIf="!isSaving">save</mat-icon>
                  <mat-icon *ngIf="isSaving" class="spinning">hourglass_empty</mat-icon>
                  {{ isSaving ? 'Salvando...' : 'Salvar Alterações' }}
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </mat-tab>

        <!-- Security Tab -->
        <mat-tab label="Segurança">
          <div class="tab-content">
            <mat-card class="password-form-card">
              <mat-card-header>
                <mat-icon mat-card-avatar>security</mat-icon>
                <mat-card-title>Alterar Senha</mat-card-title>
                <mat-card-subtitle>Mantenha sua conta segura</mat-card-subtitle>
              </mat-card-header>
              
              <mat-card-content>
                <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()">
                  <div class="form-row">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Senha atual</mat-label>
                      <input matInput type="password" formControlName="currentPassword" 
                             placeholder="Digite sua senha atual">
                      <mat-icon matSuffix>lock</mat-icon>
                      <mat-error *ngIf="passwordForm.get('currentPassword')?.hasError('required')">
                        Senha atual é obrigatória
                      </mat-error>
                    </mat-form-field>
                  </div>

                  <div class="form-row">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Nova senha</mat-label>
                      <input matInput type="password" formControlName="newPassword" 
                             placeholder="Digite sua nova senha">
                      <mat-icon matSuffix>lock_open</mat-icon>
                      <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('required')">
                        Nova senha é obrigatória
                      </mat-error>
                      <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('minlength')">
                        Senha deve ter pelo menos 6 caracteres
                      </mat-error>
                    </mat-form-field>
                  </div>

                  <div class="form-row">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Confirmar nova senha</mat-label>
                      <input matInput type="password" formControlName="confirmPassword" 
                             placeholder="Confirme sua nova senha">
                      <mat-icon matSuffix>lock</mat-icon>
                      <mat-error *ngIf="passwordForm.get('confirmPassword')?.hasError('required')">
                        Confirmação de senha é obrigatória
                      </mat-error>
                      <mat-error *ngIf="passwordForm.get('confirmPassword')?.hasError('passwordMismatch')">
                        Senhas não coincidem
                      </mat-error>
                    </mat-form-field>
                  </div>
                </form>
              </mat-card-content>

              <mat-card-actions>
                <button mat-raised-button color="primary" 
                        [disabled]="!passwordForm.valid || isSaving"
                        (click)="onChangePassword()">
                  <mat-icon *ngIf="!isSaving">security</mat-icon>
                  <mat-icon *ngIf="isSaving" class="spinning">hourglass_empty</mat-icon>
                  {{ isSaving ? 'Alterando...' : 'Alterar Senha' }}
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </mat-tab>

        <!-- My Donations Tab -->
        <mat-tab label="Minhas Doações">
          <div class="tab-content">
            <div class="section-header">
              <h3>Suas Doações</h3>
              <p>Acompanhe o status das suas doações cadastradas</p>
            </div>

            <div *ngIf="userDonations.length === 0" class="empty-state">
              <mat-icon>volunteer_activism</mat-icon>
              <h3>Nenhuma doação cadastrada</h3>
              <p>Você ainda não cadastrou nenhuma doação. Que tal começar ajudando alguém?</p>
              <button mat-raised-button color="primary" routerLink="/create-donation">
                <mat-icon>add</mat-icon>
                Cadastrar Doação
              </button>
            </div>

            <div *ngIf="userDonations.length > 0" class="donations-grid">
              <mat-card *ngFor="let donation of userDonations" class="donation-card">
                <mat-card-header>
                  <mat-card-title>{{ donation.title }}</mat-card-title>
                  <mat-card-subtitle>
                    <mat-chip [color]="getStatusColor(donation.status || '')">
                      {{ getStatusText(donation.status || '') }}
                    </mat-chip>
                  </mat-card-subtitle>
                </mat-card-header>
                
                <mat-card-content>
                  <p class="donation-description">{{ donation.description }}</p>
                  
                  <div class="donation-details">
                    <div class="detail-item">
                      <mat-icon>category</mat-icon>
                      <span>{{ donation.category }}</span>
                    </div>
                    <div class="detail-item">
                      <mat-icon>location_on</mat-icon>
                      <span>{{ donation.city }}, {{ donation.state }}</span>
                    </div>
                    <div *ngIf="donation.createdAt" class="detail-item">
                      <mat-icon>calendar_today</mat-icon>
                      <span>Criada em {{ formatDate(donation.createdAt) }}</span>
                    </div>
                  </div>
                </mat-card-content>

                <mat-card-actions>
                  <button mat-button color="primary">
                    <mat-icon>visibility</mat-icon>
                    Ver Detalhes
                  </button>
                  <button mat-button>
                    <mat-icon>edit</mat-icon>
                    Editar
                  </button>
                </mat-card-actions>
              </mat-card>
            </div>
          </div>
        </mat-tab>

        <!-- My Requests Tab -->
        <mat-tab label="Minhas Solicitações">
          <div class="tab-content">
            <div class="section-header">
              <h3>Suas Solicitações</h3>
              <p>Acompanhe o status das suas solicitações de doação</p>
            </div>

            <div *ngIf="userMatches.length === 0" class="empty-state">
              <mat-icon>inbox</mat-icon>
              <h3>Nenhuma solicitação encontrada</h3>
              <p>Você ainda não fez ou recebeu nenhuma solicitação de doação.</p>
              <button mat-raised-button color="primary" routerLink="/donations">
                <mat-icon>search</mat-icon>
                Buscar Doações
              </button>
            </div>

            <div *ngIf="userMatches.length > 0" class="requests-list">
              <mat-card *ngFor="let match of userMatches" class="request-card">
                <mat-card-header>
                  <mat-card-title>{{ match.donation?.title || 'Doação sem título' }}</mat-card-title>
                  <mat-card-subtitle>
                    <mat-chip [color]="getStatusColor(match.status || '')">
                      {{ getStatusText(match.status || '') }}
                    </mat-chip>
                  </mat-card-subtitle>
                </mat-card-header>
                
                <mat-card-content>
                  <div class="request-info">
                    <div class="requester-info">
                      <mat-icon>person</mat-icon>
                      <span>Solicitante: {{ match.requester?.name || 'Não informado' }}</span>
                    </div>
                    
                    <div class="donor-info">
                      <mat-icon>volunteer_activism</mat-icon>
                      <span>Doador: {{ match.donation?.donor?.name || 'Não informado' }}</span>
                    </div>
                    
                    <div *ngIf="match.createdAt" class="request-date">
                      <mat-icon>calendar_today</mat-icon>
                      <span>Solicitação em {{ formatDate(match.createdAt) }}</span>
                    </div>
                  </div>

                  <div *ngIf="match.message" class="request-message">
                    <p><strong>Mensagem:</strong></p>
                    <p>{{ match.message }}</p>
                  </div>
                </mat-card-content>

                <mat-card-actions>
                  <button mat-button color="primary">
                    <mat-icon>visibility</mat-icon>
                    Ver Detalhes
                  </button>
                  <button *ngIf="match.status === MatchStatus.PENDING" mat-button color="accent">
                    <mat-icon>chat</mat-icon>
                    Entrar em Contato
                  </button>
                </mat-card-actions>
              </mat-card>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
</div>
